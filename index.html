<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <title>PF100 Examples</title>

    <!-- URL Polyfill for IE -->
    <script type="text/javascript">(function(e){var t=function(){try{return!!Symbol.iterator}catch(e){return false}};var n=t();var r=function(e){var t={next:function(){var t=e.shift();return{done:t===void 0,value:t}}};if(n){t[Symbol.iterator]=function(){return t}}return t};var i=function(e){return encodeURIComponent(e).replace(/%20/g,"+")};var o=function(e){return decodeURIComponent(e).replace(/\+/g," ")};var a=function(){var t=function(e){Object.defineProperty(this,"_entries",{value:{}});if(typeof e==="string"){if(e!==""){e=e.replace(/^\?/,"");var n=e.split("&");var r;for(var i=0;i<n.length;i++){r=n[i].split("=");this.append(o(r[0]),r.length>1?o(r[1]):"")}}}else if(e instanceof t){var a=this;e.forEach(function(e,t){a.append(e,t)})}};var a=t.prototype;a.append=function(e,t){if(e in this._entries){this._entries[e].push(t.toString())}else{this._entries[e]=[t.toString()]}};a.delete=function(e){delete this._entries[e]};a.get=function(e){return e in this._entries?this._entries[e][0]:null};a.getAll=function(e){return e in this._entries?this._entries[e].slice(0):[]};a.has=function(e){return e in this._entries};a.set=function(e,t){this._entries[e]=[t.toString()]};a.forEach=function(e,t){var n;for(var r in this._entries){if(this._entries.hasOwnProperty(r)){n=this._entries[r];for(var i=0;i<n.length;i++){e.call(t,n[i],r,this)}}}};a.keys=function(){var e=[];this.forEach(function(t,n){e.push(n)});return r(e)};a.values=function(){var e=[];this.forEach(function(t){e.push(t)});return r(e)};a.entries=function(){var e=[];this.forEach(function(t,n){e.push([n,t])});return r(e)};if(n){a[Symbol.iterator]=a.entries}a.toString=function(){var e="";this.forEach(function(t,n){if(e.length>0)e+="&";e+=i(n)+"="+i(t)});return e};e.URLSearchParams=t};if(!("URLSearchParams"in e)||new URLSearchParams("?a=1").toString()!=="a=1"){a()}})(typeof global!=="undefined"?global:typeof window!=="undefined"?window:typeof self!=="undefined"?self:this);(function(e){var t=function(){try{var e=new URL("b","http://a");e.pathname="c%20d";return e.href==="http://a/c%20d"&&e.searchParams}catch(e){return false}};var n=function(){var t=e.URL;var n=function(e,t){if(typeof e!=="string")e=String(e);var n=document.implementation.createHTMLDocument("");window.doc=n;if(t){var r=n.createElement("base");r.href=t;n.head.appendChild(r)}var i=n.createElement("a");i.href=e;n.body.appendChild(i);i.href=i.href;if(i.protocol===":"||!/:/.test(i.href)){throw new TypeError("Invalid URL")}Object.defineProperty(this,"_anchorElement",{value:i})};var r=n.prototype;var i=function(e){Object.defineProperty(r,e,{get:function(){return this._anchorElement[e]},set:function(t){this._anchorElement[e]=t},enumerable:true})};["hash","host","hostname","port","protocol","search"].forEach(function(e){i(e)});Object.defineProperties(r,{toString:{get:function(){var e=this;return function(){return e.href}}},href:{get:function(){return this._anchorElement.href.replace(/\?$/,"")},set:function(e){this._anchorElement.href=e},enumerable:true},pathname:{get:function(){return this._anchorElement.pathname.replace(/(^\/?)/,"/")},set:function(e){this._anchorElement.pathname=e},enumerable:true},origin:{get:function(){var e={"http:":80,"https:":443,"ftp:":21}[this._anchorElement.protocol];var t=this._anchorElement.port!=e&&this._anchorElement.port!=="";return this._anchorElement.protocol+"//"+this._anchorElement.hostname+(t?":"+this._anchorElement.port:"")},enumerable:true},password:{get:function(){return""},set:function(e){},enumerable:true},username:{get:function(){return""},set:function(e){},enumerable:true},searchParams:{get:function(){var e=new URLSearchParams(this.search);var t=this;["append","delete","set"].forEach(function(n){var r=e[n];e[n]=function(){r.apply(e,arguments);t.search=e.toString()}});return e},enumerable:true}});n.createObjectURL=function(e){return t.createObjectURL.apply(t,arguments)};n.revokeObjectURL=function(e){return t.revokeObjectURL.apply(t,arguments)};e.URL=n};if(!t()){n()}if(e.location!==void 0&&!("origin"in e.location)){var r=function(){return e.location.protocol+"//"+e.location.hostname+(e.location.port?":"+e.location.port:"")};try{Object.defineProperty(e.location,"origin",{get:r,enumerable:true})}catch(t){setInterval(function(){e.location.origin=r()},100)}}})(typeof global!=="undefined"?global:typeof window!=="undefined"?window:typeof self!=="undefined"?self:this);
    </script>
    <script type="text/javascript" src="https://static.sketchfab.com/api/sketchfab-viewer-1.1.0.js"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.12/js/all.js" integrity="sha384-Voup2lBiiyZYkRto2XWqbzxHXwzcm4A5RfdfG6466bu5LqjwwrjXCMBQBLMWh7qR" crossorigin="anonymous"></script>
    <style>
      .selector {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: 2px solid grey;
        cursor: pointer;
        margin: auto;
        box-sizing: border-box;
      }

      .inner-circle {
        width: 22px;
        height: 22px;
        border-radius: 50%;
        margin: 1.5px;
        pointer-events: none;
      }
      .selector.red .inner-circle {
        background: rgb(174, 54, 58);
      }
      .selector.green .inner-circle {
        background: rgb(59, 113, 68);
      }

      .selector.black .inner-circle {
        background: black;
      }

      .selector.active {
        border-color: white;
      }

      .selector.dark .inner-circle {
        background: #333;
      }

      .selector.light .inner-circle {
        background: rgb(246, 239, 128);
      }

      .selector.single .inner-circle,
      .selector.double .inner-circle {
        background: white;
        overflow: hidden;
      }

      .inner-circle-half {
        width: 50%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
      }
      #tools {
        position: absolute;
        bottom: 20px;
        right: 0;
        width: 200px;
        z-index: 999;
        text-align: right;
        display: flex;
        flex-wrap: wrap;
        padding: 1em;
      }

      .tool-container {
        overflow: auto;
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-end;
        width: 100%;
        margin-bottom: 1em;
      }

      .tool-header {
        width: 100%;
        font-family: myriad, sans-serif;
        font-size: 40px;
        border-bottom: 2px solid white;
        color: white;
        width: 100%;
        margin-right: 0.25em;
      }

      .toggle-container {
        text-align: center;
        width: 33%;
      }

      p {
        font-family: myriad, sans-serif;
        color: white;
        margin-bottom: 3px;
      }

      .inner-circle svg {
        fill: black;
        color: black;
        margin-top: 2px;
        padding: 1px;
      }


    </style>
</head>

<body>
    <div id="tools">
      <div class="tool-container">
        <div class="tool-header">Color</div>
        <div class="toggle-container">
          <p>red</p>
          <div data-toggle="on" class="selector red active color-selector" data-obj-id="539">
            <div class="inner-circle"></div>
          </div>
        </div>
        <div class="toggle-container">
          <p>green</p>
          <div data-toggle="off" class="selector green color-selector" data-obj-id="545">
            <div class="inner-circle"></div>
          </div>
        </div>
        <div class="toggle-container">
          <p>black</p>
          <div data-toggle="off" class="selector black color-selector" data-obj-id="546">
            <div class="inner-circle"></div>
          </div>
        </div>
      </div><!-- .tool-container -->
      <div class="tool-container">
        <div class="tool-header">Light</div>
        <div class="toggle-container">
          <p>on</p>
          <a href=""><div class="selector lighting light">
            <div class="inner-circle"></div>
          </div></a>
        </div>
        <div class="toggle-container">
          <p>off</p>
          <a href=""><div class="selector lighting dark">
            <div class="inner-circle"></div>
          </div></a>
        </div>
      </div><!-- .tool-container -->
      <div class="tool-container">
        <div class="tool-header">Style</div>
        <div class="toggle-container">
          <p>single</p>
          <a href=""><div class="selector style single">
            <div class="inner-circle"><i class="fas fa-angle-left"></i></div>
          </div></a>
        </div>
        <div class="toggle-container">
          <p>double</p>
          <a href=""><div class="selector style double">
            <div class="inner-circle"><i class="fas fa-angle-left"></i><i class="fas fa-angle-right"></i></div>
          </div></a>
        </div>
      </div><!-- .tool-container -->
    </div>
    <!-- Insert an empty iframe -->
    <iframe style="display: block; position: absolute; width: 100%; height: 100%; left: 0; top: 0; border: 0;" width="640" height="480" id="api-frame" allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>

    <script
      src="https://code.jquery.com/jquery-3.3.1.min.js"
      integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
      crossorigin="anonymous"></script>
    <!-- Initialize the viewer -->

    <script type="text/javascript">
    // Set up some vars to hold the ids that we must hardcode
    var redId, greenId, blackId;

    // A function to get and set parameters from the URL
    function getUrl(newParam, newValue) {
      var url = new URL(window.location.href);
      var lighting = url.searchParams.get("lighting") ? url.searchParams.get('lighting') : 'light';
      var style = url.searchParams.get('style') ? url.searchParams.get('style') : 'single';
      if(newParam == 'lighting') {
        lighting = newValue;
      }
      if(newParam == 'style') {
        style = newValue;
      }

      return ('?lighting=' + lighting + '&style=' + style);

    }
    var url = new URL(window.location.href);
    var lighting = url.searchParams.get("lighting");
    var style = url.searchParams.get("style");
    var iframe = document.getElementById( 'api-frame' );

    var urlid = '';
    // Depending on the URL parameters passed, we get one of 4 different sketchfab scenes
    if(lighting == 'light') {
      urlid = style == 'single' ? '862a4c5e229d4ee7a4ca89c7a5a65481' : 'aa8fb1ef183b4774bc8e9d9d833ba81d';
    }
    else {
      urlid = style == 'single' ? '08b2d2ff8dd046e59f5dc9c35587dac7' : 'a57b8d9d5c584ca992e336fb4dda1249';
    }
    // UI Click Handlers
    jQuery('document').ready(function($) {
      // Control active state for CSS rules
      if(lighting == 'dark') {
        $('.selector.dark').addClass('active');
      }
      else {
        $('.selector.light').addClass('active');
      }
      if(style == 'single') {
        $('.selector.single').addClass('active');
      }
      else {
        $('.selector.double').addClass('active');
      }

      // Modify the URL
      $('a').each(function(i, a) {
        var $inner = $(a).find('div');
        if($inner.hasClass('light')) {
          $(a).attr('href', getUrl('lighting',  'light'));
        }
        else if($inner.hasClass('dark')) {
          $(a).attr('href', getUrl('lighting',  'dark'));
        }
        else if($inner.hasClass('single')) {
          $(a).attr('href', getUrl('style',  'single'));
        }
        else if($inner.hasClass('double')) {
          $(a).attr('href', getUrl('style',  'double'));
        }
      });

      // Hardcoded ID's which can be seen inside the sketchfab file js data
      if(lighting == 'light') {
        if(style == 'single') {
          redId = 539;
          greenId = 545;
          blackId = 546;
        }
        else {
          redId = 539;
          greenId = 545;
          blackId = 546;
        }
      }
      else {
        if(style == 'single') {
          redId = 539;
          greenId = 545;
          blackId = 546;
        }
        else {
          redId = 539;
          greenId = 545;
          blackId = 546;
        }
      }

      // Add data-obj-id to the selectors based on their class
      $('.color-selector').each(function(i, cs) {
        if($(cs).hasClass('red')) {
          $(cs).data('obj-id', redId);
        }
        else if($(cs).hasClass('green')) {
          $(cs).data('obj-id', greenId);
        }
        else {
          $(cs).data('obj-id', blackId);
        }
      });
    });

    // By default, the latest version of the viewer API will be used.
    var client = new Sketchfab( iframe );

    // Alternatively, you can request a specific version.
    // var client = new Sketchfab( '1.0.0', iframe );

    client.init( urlid, {
        success: function onSuccess( api ){
            api.start();
            api.addEventListener( 'viewerready', function() {
              // Console log the nodes, so that a dev can see the id's
              api.getNodeMap( function (err, nodes) {
                if( !err ) {
                  console.log(nodes);
                }
              });


              // API is ready to use
              // Insert your code here
              // Hide all but the red model
              api.hide(greenId);
              api.hide(blackId);

              // Click handler for the selectors that choose the color
              $('.color-selector').on('click', function(e) {
                $('.selector').not('.lighting').not('.style').removeClass('active');
                $(e.target).addClass('active');
                hideAll(api);
                api.show($(e.target).data('obj-id'));
              });
          } );
        },
        error: function onError() {
            console.log( 'Viewer error' );
        }
    } );

    function hideAll(api) {
      api.hide(redId);
      api.hide(greenId);
      api.hide(blackId);
    }
    </script>
</body>
</html>
